<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Task Pulse</title>
  <meta name="theme-color" content="#1d1d1f" />

  <link rel="manifest" href="manifest.json" />
  <link rel="apple-touch-icon" sizes="192x192" href="icon-192.png" />
  <link rel="apple-touch-icon" sizes="512x512" href="icon-512.png" />

  <style>
    *{box-sizing:border-box;margin:0;padding:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,sans-serif}
    body{background:#f4f4f6;max-width:480px;margin:0 auto;color:#1a1a1a}
    .hidden{display:none!important}.small{font-size:.8rem;color:#666}

    /* Splash */
    #splash-screen{position:fixed;top:0;left:0;width:100%;height:100%;
      background:#000;display:flex;align-items:center;justify-content:center;
      z-index:9999;opacity:1;transition:opacity 1s ease-in-out}
    #splash-screen.fade-out{opacity:0;pointer-events:none}
    #splash-screen img{width:100%;height:100%;object-fit:cover}

    header{background:radial-gradient(circle at 20% 20%,#2c2c2f 0%,#1d1d1f 60%);
      color:#fff;padding:16px;border-bottom:1px solid #000;border-radius:0 0 20px 20px}
    .today-label{font-size:.8rem;color:#bdbdbd}
    .today-date{font-size:1.1rem;font-weight:600}

    main{padding:16px 16px 80px}
    .today-block,.history-block,.settings-block{
      background:#fff;border:1px solid #ededed;border-radius:16px;
      box-shadow:0 10px 24px rgba(0,0,0,.05);padding:16px;margin-bottom:20px}

    .section-headline{display:flex;justify-content:space-between;margin-bottom:12px}
    .section-title{font-size:1rem;font-weight:600}

    .task-row{display:flex;justify-content:space-between;border:1px solid #e4e4e7;
      border-radius:12px;padding:12px;margin-bottom:10px}
    .task-check{width:20px;height:20px;border-radius:6px;border:2px solid #1d1d1f;
      display:flex;align-items:center;justify-content:center;font-size:.7rem;cursor:pointer}
    .task-check.done{background:#1d1d1f;color:#fff}
    .priority-pill{font-size:.7rem;border-radius:6px;padding:2px 6px;text-transform:uppercase;font-weight:600}
    .priority-high{background:#ff4d4d;color:#fff}
    .priority-med{background:#ffb84d;color:#1a1a1a}
    .priority-low{background:#d9d9d9;color:#1a1a1a}

    .add-row{display:flex;flex-direction:column;gap:10px;background:#f9f9fa;
      border:1px dashed #cfcfd3;border-radius:12px;padding:12px;margin-top:16px}
    .add-top{display:flex;flex-wrap:wrap;gap:8px}
    .add-input,.priority-select{border:1px solid #cfcfd3;border-radius:10px;padding:10px 12px;font-size:.9rem;background:#fff}
    .add-input{flex:1}
    .add-btn{border-radius:10px;background:#1d1d1f;color:#fff;border:1px solid #1d1d1f;font-size:.85rem;padding:10px 14px}

    .history-nav button{background:#fff;border:1px solid #cfcfd3;padding:8px 10px;
      border-radius:10px;font-size:1rem}

    .settings-action{background:#1d1d1f;color:#fff;border:1px solid #1d1d1f;
      border-radius:10px;padding:8px 10px;font-size:.8rem}
  </style>
</head>
<body>
  <!-- Splash -->
  <div id="splash-screen">
    <img src="TaskPulse_Splash_Powered_By_DarylG.png" alt="Task Pulse Splash" />
  </div>

  <!-- Header -->
  <header>
    <div class="today-label">Today</div>
    <div class="today-date" id="todayDate">--</div>
  </header>

  <!-- Version marker -->
  <div style="text-align:center;font-size:.7rem;color:#999;padding:4px 0;">
    build: todays-tasks-v1
  </div>

  <main>
    <!-- Today -->
    <section id="todaySection" class="today-block">
      <div class="section-headline">
        <div class="section-title">Today's Tasks</div>
        <div class="section-sub" id="todayStats">0 / 0 done (0%)</div>
      </div>
      <div id="todayTaskList"></div>
      <div class="add-row">
        <div class="add-top">
          <input id="newTaskName" class="add-input" placeholder="Add task…" />
          <select id="newTaskPriority" class="priority-select">
            <option value="high">high</option>
            <option value="med">med</option>
            <option value="low" selected>low</option>
          </select>
          <button id="addTaskBtn" class="add-btn">Add</button>
        </div>
      </div>
    </section>

    <!-- History -->
    <section id="screen-history" class="history-block">
      <div class="section-headline">
        <div>
          <div class="small">Viewing</div>
          <div id="historyDateLabel" style="font-size:.9rem;font-weight:600;color:#111;">--</div>
        </div>
        <div class="history-nav">
          <button id="prevDayBtn">◀</button>
          <button id="nextDayBtn">▶</button>
        </div>
      </div>
      <div class="small" id="historyStats" style="margin-bottom:12px;">--</div>
      <div id="historyTaskList"></div>
    </section>

    <!-- Sync -->
    <section id="screen-settings" class="settings-block">
      <div class="section-title">Sync between devices</div>
      <p style="font-size:.8rem;margin-bottom:12px;">
        This code links multiple devices to the same Task Pulse list.
        (Currently offline-only; cloud sync will activate once Firebase keys are added.)
      </p>
      <div>
        <div class="small" style="font-weight:600;">Your Sync Code</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="syncCodeDisplay" class="add-input" readonly style="font-family:monospace;font-size:.8rem;">
          <button id="copySyncCodeBtn" class="settings-action">Copy</button>
        </div>
      </div>
      <br>
      <div>
        <div class="small" style="font-weight:600;">Join using Sync Code</div>
        <div style="display:flex;gap:8px;align-items:center;">
          <input id="syncCodeInput" class="add-input" placeholder="paste code here">
          <button id="joinSyncBtn" class="settings-action">Join</button>
        </div>
      </div>
    </section>
  </main>

<script>
function hideSplashScreen(){
  const s=document.getElementById('splash-screen');
  if(!s)return;setTimeout(()=>s.classList.add('fade-out'),1800);
}
function loadTasks(){return JSON.parse(localStorage.getItem('tp_tasks')||'[]')}
function saveTasks(t){localStorage.setItem('tp_tasks',JSON.stringify(t))}
function todayISO(){const d=new Date();return d.toISOString().slice(0,10)}
function fmtDate(d){const[a,b,c]=d.split('-');return `${c}-${b}-${a}`}
function nowTime(){return new Date().toTimeString().slice(0,5)}
function createTask(o){return{id:'t_'+Math.random().toString(36).slice(2,9),
  name:o.name,priority:o.priority,status:o.status||'not done',
  timeCompleted:o.timeCompleted||'',dateAssigned:o.dateAssigned||todayISO()}}

function renderToday(){
  const list=document.getElementById('todayTaskList');
  const stats=document.getElementById('todayStats');
  const tasks=loadTasks().filter(t=>t.dateAssigned===todayISO());
  const done=tasks.filter(t=>t.status==='done').length;
  stats.textContent=`${done} / ${tasks.length} done (${tasks.length?Math.round(done/tasks.length*100):0}%)`;
  list.innerHTML=tasks.map(t=>{
    const pr=t.priority==='high'?'priority-high':t.priority==='med'?'priority-med':'priority-low';
    const done=t.status==='done'?'done':'';
    return `<div class="task-row" data-id="${t.id}">
      <div class="task-check ${done}" data-role="toggleTask">${done?'✓':''}</div>
      <div style="flex:1;margin-left:8px;">
        <div><span class="task-name">${t.name}</span> <span class="priority-pill ${pr}">${t.priority}</span></div>
        <div class="small">${t.status==='done'?'✔ Done at '+(t.timeCompleted||'—'):'Not done'}</div>
      </div></div>`;
  }).join('');
  list.querySelectorAll('[data-role="toggleTask"]').forEach(c=>c.onclick=()=>{
    const id=c.closest('.task-row').dataset.id;toggleTask(id)});
}
function toggleTask(id){
  const tasks=loadTasks();const i=tasks.findIndex(t=>t.id===id);
  if(i<0)return;const t=tasks[i];
  t.status=t.status==='done'?'not done':'done';
  t.timeCompleted=t.status==='done'?nowTime():'';
  saveTasks(tasks);renderAll();
}
function addTask(){
  const n=document.getElementById('newTaskName').value.trim();
  const p=document.getElementById('newTaskPriority').value;
  if(!n)return;const ts=loadTasks();ts.push(createTask({name:n,priority:p}));
  saveTasks(ts);document.getElementById('newTaskName').value='';renderAll();
}
function renderHistory(){
  const tasks=loadTasks();const d=todayISO();
  const h=document.getElementById('historyDateLabel');h.textContent=fmtDate(d);
  const hList=document.getElementById('historyTaskList');
  hList.innerHTML=tasks.filter(t=>t.dateAssigned===d).map(t=>
    `<div class="small">• ${t.name} (${t.priority}) — ${t.status}</div>`).join('');
}
function signInAnon(){
  let code=localStorage.getItem('tp_sync_code');
  if(!code){code='local-'+Math.random().toString(36).slice(2,7);
    localStorage.setItem('tp_sync_code',code);}
  document.getElementById('syncCodeDisplay').value=code;
}
function bindSync(){
  document.getElementById('copySyncCodeBtn').onclick=()=>{
    navigator.clipboard.writeText(document.getElementById('syncCodeDisplay').value);
  };
  document.getElementById('joinSyncBtn').onclick=()=>{
    const c=document.getElementById('syncCodeInput').value.trim();
    if(c)localStorage.setItem('tp_sync_code',c);
  };
}
function renderAll(){
  document.getElementById('todayDate').textContent=fmtDate(todayISO());
  renderToday();renderHistory();
}
function init(){
  hideSplashScreen();
  document.getElementById('addTaskBtn').onclick=addTask;
  signInAnon();bindSync();renderAll();
  if('serviceWorker'in navigator)
    navigator.serviceWorker.register('sw.js');
}
init();
</script>
</body>
</html>
